<!doctype html>
<html>
<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-295433-8"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-295433-8');
    </script>

    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Helpers</title>
    <link href='/aegis/slate/stylesheets/monokai.css' rel="stylesheet" media="screen" />
<link href='/aegis/slate/stylesheets/screen.css' rel="stylesheet" media="screen" />
<link href='/aegis/slate/stylesheets/print.css' rel="stylesheet" media="print" />

    <link href='/aegis/css/styles.css' rel="stylesheet"/>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.0.13/css/solid.css" integrity="sha384-drdlAcijFWubhOfj9OS/gy2Gs34hVhVT90FgJLzrldrLI+7E7lwBxmanEEhKTRTS" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.0.13/css/brands.css" integrity="sha384-t3MQUMU0g3tY/0O/50ja6YVaEFYwPpOiPbrHk9p5DmYtkHJU2U1/ujNhYruOJwcj" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.0.13/css/fontawesome.css" integrity="sha384-LDuQaX4rOgqi4rbWCyWj3XVBlgDzuxGy/E6vWN6U7c25/eSJIwyKhy9WgZCHQWXz" crossorigin="anonymous">
    
<script src='/aegis/slate/javascripts/all.js'></script>

    
</head>
<body class="index" data-languages="">
    <div class="main-nav-wrapper">
        <ul class="main-menu">
            <li class="">
    <a href="/aegis/">Getting Started</a>
</li>


    
    <li class="">
        <a href="/aegis/routers/" title="Aegis Routers">Routers</a>
    </li>
    

    
    <li class="">
        <a href="/aegis/handler-dependencies/" title="Aegis Dependencies">Dependencies</a>
    </li>
    

    
    <li class="active">
        <a href="/aegis/helpers/" title="Aegis Helpers">Helpers</a>
    </li>
    

    
    <li class="">
        <a href="/aegis/cli/" title="Aegis Command Line Interface">CLI</a>
    </li>
    

        </ul>
    </div>
    <a href="#" id="nav-button">
        <span>
        NAV
        <img src='/aegis/slate/images/navbar.png'/>
      </span>
    </a>
    <div class="tocify-wrapper">
        
         
 <div id="logo-type">
    <h1 class="toc-ignore">Aegis</h1>
    <h2 class="toc-ignore">An AWS Serverless Framework for Go</h2>
</div>
         
        <aside class="main-menu-sidebar-wrapper">
    <ul class="main-menu-sidebar">
        <li class="">
    <a href="/aegis/">Getting Started</a>
</li>


    
    <li class="">
        <a href="/aegis/routers/" title="Aegis Routers">Routers</a>
    </li>
    

    
    <li class="">
        <a href="/aegis/handler-dependencies/" title="Aegis Dependencies">Dependencies</a>
    </li>
    

    
    <li class="active">
        <a href="/aegis/helpers/" title="Aegis Helpers">Helpers</a>
    </li>
    

    
    <li class="">
        <a href="/aegis/cli/" title="Aegis Command Line Interface">CLI</a>
    </li>
    

    </ul>
</aside>
        
        <div class="search">
            <input type="text" class="search" id="input-search" placeholder='Search This Section'>
        </div>
        <ul class="search-results"></ul>
        
        <div id="toc">
        </div>
         
        
        <ul class="toc-footer">
            
            <li><a class='github-link' href='https://github.com/tmaiaroto/aegis' target='_blank' title='Aegis on GitHub'><i class='fab fa-github'></i> Aegis on GitHub</a></li>
            
            <li><div class='hugo-theme-credit'>Hugo Theme by <a href='https://github.com/bep' target='_blank'>bep</a></div>
</li>
            
        </ul>
        
        
    </div>
    <div class="page-wrapper">
        <div class="dark-box"></div>
        <div class="content">
            
    
        

<h1 id="aegis-variables">Aegis Variables</h1>

<blockquote>
<p>Access via Aegis interface</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">barStr</span> <span class="o">:=</span> <span class="nx">AegisApp</span><span class="p">.</span><span class="nx">GetVariable</span><span class="p">(</span><span class="s">&#34;foo&#34;</span><span class="p">)</span></code></pre></div>
<blockquote>
<p>Access via HandlerDependencies</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">d</span> <span class="o">*</span><span class="nx">aegis</span><span class="p">.</span><span class="nx">HandlerDependencies</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">aegis</span><span class="p">.</span><span class="nx">APIGatewayProxyRequest</span><span class="p">,</span> <span class="nx">res</span> <span class="o">*</span><span class="nx">aegis</span><span class="p">.</span><span class="nx">APIGatewayProxyResponse</span><span class="p">,</span> <span class="nx">params</span> <span class="nx">url</span><span class="p">.</span><span class="nx">Values</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">barStr</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">GetVariable</span><span class="p">(</span><span class="s">&#34;foo&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span></code></pre></div>
<blockquote>
<p>Access the map directly</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">d</span> <span class="o">*</span><span class="nx">aegis</span><span class="p">.</span><span class="nx">HandlerDependencies</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">aegis</span><span class="p">.</span><span class="nx">APIGatewayProxyRequest</span><span class="p">,</span> <span class="nx">res</span> <span class="o">*</span><span class="nx">aegis</span><span class="p">.</span><span class="nx">APIGatewayProxyResponse</span><span class="p">,</span> <span class="nx">params</span> <span class="nx">url</span><span class="p">.</span><span class="nx">Values</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">barStr</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">Services</span><span class="p">.</span><span class="nx">Variables</span><span class="p">[</span><span class="s">&#34;foo&#34;</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="c1">// ...
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span></code></pre></div>
<p>One of the most important helpers is the one to work with <strong><em>Aegis Variables</em></strong> which is just a conventional environment
variable. It could be an actual environment variable on the operating system, an AWS Lambda environment variable that
was configured, or an API Gateway stage variable.</p>

<p>So that means the helper function checks those locations in the following order:</p>

<ul>
<li>Lambda environment variable</li>
<li>API Gateway stage variable</li>
<li>Actual operating system environment variable</li>
</ul>

<p>The helper function is available on the <code>Aegis</code> interface or <code>HandlerDependencies</code>. A string value is always returned
because that&rsquo;s the only data type these variables can be.</p>

<p>You could also forgo the helper and access these variables on handler dependencies. It&rsquo;s considered a service.
So you&rsquo;ll find everything under <code>Services.Variables</code>.</p>

<p>Just note that the helper will check for an actual environment variable as a last resort. Accessing the <code>Services</code>
in handler dependencies will not include environment variables since this map is set by AWS Lambda and API Gateway
configurations.</p>

<p>Note that this works really well in conjunction with the <code>secret</code> CLI command. <a href="/aegis/cli/#secret">See here for more info.</a></p>

    
        

<h1 id="api-gateway-proxy-http">API Gateway Proxy (HTTP)</h1>

<p>There are quite a few helpers for working with API Gateway Proxy responses and requests. You can read about
all of them through Go documentation.</p>

<ul>
<li><a href="https://godoc.org/github.com/tmaiaroto/aegis/framework#APIGatewayProxyResponse" target="_blank">APIGatewayProxyResponse</a></li>
<li><a href="https://godoc.org/github.com/tmaiaroto/aegis/framework#APIGatewayProxyRequest" target="_blank">APIGatewayProxyRequest</a></li>
</ul>

<p>Though let&rsquo;s take a look at some of the more common ones here.</p>

<h2 id="apigatewayproxyrequest">APIGatewayProxyRequest</h2>

<p>API Gateway requests are not HTTP requests. They come into Lambda as JSON messages. The AWS Lambda Go package,
and therefore Aegis, marshals these messages to structs. That&rsquo;s great, but it still doesn&rsquo;t give us an easy
way to work with the request as if though it were an actual HTTP request. If you wanted to get a cookie, it
would be rather annoying to be frank.</p>

<p><strong>GetHeader()</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">auth</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">GetHeader</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">)</span>
<span class="nx">cookiesString</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">GetHeader</span><span class="p">(</span><span class="s">&#34;Cookie&#34;</span><span class="p">)</span></code></pre></div>
<p>This will return a given header&rsquo;s value by name. Pretty easy, but you should note that getting the <code>Cookie</code>
header isn&rsquo;t exactly going to be real useful by itself. You&rsquo;ll need to parse that string. What you&rsquo;ll get
is a string like <span class="nowrap"><code>yummy_cookie=choco; tasty_cookie=strawberry</code></span>, which isn&rsquo;t
great to then extract the one you&rsquo;re after.</p>

<p><strong>Cookie() and Cookies()</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">cookie</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">(</span><span class="s">&#34;yummy_cookie&#34;</span><span class="p">)</span>
<span class="nx">allCookies</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Cookies</span><span class="p">()</span></code></pre></div>
<p>So this helper function does just that. It mimicks Go&rsquo;s standard <code>http</code> package. In fact, Go&rsquo;s standard
package was used to create an empty HTTP request with just the cookie header set. That then allows the
<code>Cookie()</code> function to be used. So when you call this function, the same exact function is called against
Go&rsquo;s standard library using this fake request that was created.</p>

<p>Obviously then, <code>Cookies()</code> calls the standard HTTP request&rsquo;s same name function. It returns <code>[]*Cookie</code>.</p>

<p><strong>GetBody(), GetJSONBody(), and GetForm()</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">bodyString</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">GetBody</span><span class="p">()</span>
<span class="nx">bodyMap</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">GetJSONBody</span><span class="p">()</span>
<span class="nx">formMap</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">GetForm</span><span class="p">()</span></code></pre></div>
<p>These helper functions are used for getting the body content of an API Gateway request. One will give you
a string while the other will give you a map. It saves you from needing to decode some things.</p>

<p><code>GetForm()</code> can be helpful if you made a multipart POST request. If will parse the form values and return
to you a <span class="nowrap"><code>map[string]interface{}</code></span>.</p>

<p><strong>UserAgent()</strong></p>

<p>We don&rsquo;t actually need to parse headers or use <code>GetHeader()</code> just to get the <span class="nowrap"><code>User-Agent</code></span>,
instead there&rsquo;s simply <span class="nowrap"><code>UserAgent()</code></span>.</p>

<p><strong>IP()</strong></p>

<p>AWS API Gateway will set the requesting client&rsquo;s IP address as well. So just like getting the <code>User-Agent</code>,
you can simply get the IP address using <code>IP()</code>. Both of these values are under <span class="nowrap"><code>req.RequestContext.Identity</code></span>.
So they aren&rsquo;t hard to get at, but you have to type and remember more.</p>

<h2 id="apigatewayproxyresponse">APIGatewayProxyResponse</h2>

<p>There are some great helper functions on the response struct as well. Obviously, these are all about returning
data to the client. Things like the HTTP status code, body content, and more.</p>

<p><strong>String(), HTML(), JSON(), JSONP(), XML(), and XMLPretty()</strong></p>

<p>These are your basic body content helpers. They all take a <code>status</code> int value as their first argument. This
automatically sets the status rather than requiring you to use <code>SetStatus()</code> or assign the struct property
yourself. The second argument will then vary a little.</p>

<p>Some methods will take an <code>interface{}</code> while others, like <code>HTML()</code> and <code>String()</code> will simply take a <code>string</code>.
Those taking an interface are going to be doing a little bit of work of course.</p>

    
        

<h1 id="cognito">Cognito</h1>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">router</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;/protected&#34;</span><span class="p">,</span> <span class="nx">cognitoProtected</span><span class="p">,</span> <span class="nx">aegis</span><span class="p">.</span><span class="nx">ValidAccessTokenMiddleware</span><span class="p">)</span></code></pre></div>
<p>There&rsquo;s a Cognito client helper interface which is obviously a lot more involved than a simple function.
Then there&rsquo;s also a smaller middleware helper function called <span class="nowrap"><code>ValidAccessTokenMiddleware</code>.</span></p>

<p>You can use this middleware like any other middleware with your route handlers. It uses the Cognito
client interface&rsquo;s <span class="nowrap"><code>ParseAndVerifyJWT()</code></span> function to check a JWT that you&rsquo;ll need to send
in under an <code>access_token</code> cookie in your HTTP request.</p>

<p>You can certainly check out <span class="nowrap"><code>cognito_helpers.go</code></span> for how that works if you&rsquo;d like to do
something similar on your own.</p>

    

        </div>
        <div class="dark-box">
            
        </div>
    </div>
    
</body>
</html>
